<!DOCTYPE html>
<html>
<head>
    <title>Web developer and Pianist â€“ Henry Blyth</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="css/valentines.css">
    <link href='http://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>
</head>
<body>

    <div class="wrapper page-valentines">
        <div class="inner">

            <p id="loading">Loading</p>

            <div id="main" style="display: none" class="page-body">
                <div class="text-start">
                    <h1>Touch me...</h1>
                </div>

                <div class="text-during">
                    <p class="no-force-touch">keep going...</p>
                    <p class="force-touch">harder...</p>
                </div>

                <div class="text-reset">
                    <p>don't stop!</p>
                </div>

                <div class="text-end">
                    <h1>Happy Valentines Day</h1>
                    <p>I love you!</p>
                </div>

                <div id="valentines">
                    <div id="circle" class="circle"></div>
                    <i id="heart" class="fa"></i>
                </div>

                <p class="code-link text-end">
                    See the code <a href="http://github.com/henrahmagix/valentines">here</a>
                </p>
            </div>

        </div>
    </div>

    <script src="lib/pressure/dist/pressure.min.js"></script>
    <script>
        var valentines = document.getElementById('valentines');
        var heart = document.getElementById('heart');
        var circle = document.getElementById('circle');

        var ended = false;

        var start = function () {
            document.body.classList.add('start');
            document.body.classList.remove('end', 'reset');
        };
        var end = function () {
            document.body.classList.add('end');
            document.body.classList.remove('start', 'reset');
            ended = true;
        };
        var reset = function () {
            document.body.classList.add('reset');
            document.body.classList.remove('start', 'end');
        };

        // Without force touch.
        var timeout;
        var delay = 2000; // 2 seconds
        // Mouse or touch events.
        var eventIn = 'mousedown';
        var eventOut = 'mouseup';
        if ('ontouchstart' in window) {
            eventIn = 'touchstart';
            eventOut = 'touchend';
        }

        var heartStart = function () {
            start();
            timeout = setTimeout(function () {
                endNoForceTouch();
                end();
            }, delay);
        };
        var heartEnd = function () {
            clearTimeout(timeout);
            reset();
        };

        var startForceTouch = function () {
            document.body.classList.add('force-touch');
        };
        var startNoForceTouch = function () {
            document.body.classList.add('no-force-touch');
            valentines.addEventListener(eventIn, heartStart, false);
            valentines.addEventListener(eventOut, heartEnd, false);
        };
        var endNoForceTouch = function () {
            valentines.removeEventListener(eventIn, heartStart);
            valentines.removeEventListener(eventOut, heartEnd);
        };
        var cancelNoForceTouch = function () {
            heartEnd();
            endNoForceTouch();
        };

        // With force touch.
        var styleForceValue = function (forceValue) {
            // Style the circle and heart like iOS 9+ 3d touch.
            // Copied from https://github.com/freinbichler/3d-touch/blob/e8f606284c2e08b039b3a2e595c4d6b1e2e52055/3dtouch.js#L47-L48
            heart.style.webkitTransform = 'translateX(-50%) translateY(-50%) scale(' + (1 + forceValue * 1.5) + ')';
            circle.style.webkitFilter = 'blur(' + forceValue * 30 + 'px)';
        };

        // Pressure.js http://yamartino.github.io/pressure/
        var isSetup = false;
        Pressure.set(valentines, {
            start: function (event) {
                if (ended) {
                    return;
                }
                if (!isSetup) {
                    startForceTouch();
                }
                start();
            },
            end: function (event) {
                if (ended) {
                    return;
                }
                styleForceValue(0);
                reset();
            },
            change: function (forceValue, event) {
                if (ended) {
                    return;
                }
                styleForceValue(forceValue);
                if (forceValue >= 0.95) {
                    end();
                }
            },
            unsupported: function () {
                // Use non-force-touch functions.
                if (!isSetup) {
                    // Only run once.
                    heartStart();
                    startNoForceTouch();
                }
                isSetup = true;
            }
        });

        // Finish loading. A function in the event queue will only be processed
        // once every other bit of JavaScript here has run.
        setTimeout(function () {
            document.getElementById('main').style.display = '';
            document.getElementById('loading').style.display = 'none';
        }, 1000);
    </script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-53059920-3', 'auto');
        ga('send', 'pageview');
    </script>

</body>
</html>
